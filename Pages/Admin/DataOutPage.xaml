<Page x:Class="Razbor_DE.Pages.DataOutPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Razbor_DE.AppData.Converters"
      mc:Ignorable="d" 
      Title="DataOutPage"
      Background="#F0F2F5">

    <Page.Resources>
        <local:SupplierNamesConverter x:Key="SupplierNamesConverter"/>
        <local:PageToColorConverter x:Key="PageToColorConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Кнопки справа -->
        <StackPanel Grid.Row="0" Grid.RowSpan="3" Grid.Column="1" Orientation="Vertical" 
                    HorizontalAlignment="Right" VerticalAlignment="Top" 
                    Margin="10,10,10,10">
            <Button x:Name="addBtn" Content="Добавить" Width="105" Height="40" Margin="3"
                    Background="#2ECC71" Foreground="White" FontSize="14"
                    FontWeight="Bold" BorderThickness="0" Cursor="Hand" Click="addBtn_Click"/>
            <Button x:Name="editBtn" Content="Редактировать" Width="105" Height="40" Margin="3"
                    Background="#3498DB" Foreground="White" FontSize="14"
                    FontWeight="Bold" BorderThickness="0" Cursor="Hand" Click="editBtn_Click"/>
            <Button x:Name="deleteBtn" Content="Удалить" Width="105" Height="40" Margin="3"
                    Background="#FFFF5D5D" Foreground="White" FontSize="14"
                    FontWeight="Bold" BorderThickness="0" Cursor="Hand" Click="deleteBtn_Click"/>
        </StackPanel>

        <!-- Верхняя панель -->
        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="10,10,10,10" 
                    Background="White" Height="60" VerticalAlignment="Top">
            <StackPanel Orientation="Vertical" Margin="0,0,20,0">
                <TextBlock Text="Введите для поиска" Foreground="Gray" FontSize="12" Margin="0,0,0,2"/>
                <TextBox x:Name="TextSearch" Width="150" Height="25" TextChanged="TextSearch_TextChanged"
                         BorderBrush="LightGray" BorderThickness="1"/>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="20,0,20,0">
                <TextBlock Text="Сортировка" Foreground="Gray" FontSize="12" Margin="0,0,0,2"/>
                <ComboBox x:Name="ComboSort" Width="120" Height="25" SelectionChanged="ComboSort_SelectionChanged">
                    <ComboBoxItem Content="По названию"/>
                    <ComboBoxItem Content="По остатку"/>
                    <ComboBoxItem Content="Нет"/>
                </ComboBox>
            </StackPanel>

            <StackPanel Orientation="Vertical" Margin="20,0,0,0">
                <TextBlock Text="Фильтрация" Foreground="Gray" FontSize="12" Margin="0,0,0,2"/>
                <ComboBox x:Name="ComboBox" Width="120" Height="25" DisplayMemberPath="Name" 
                          SelectionChanged="ComboBox_SelectionChanged"/>
            </StackPanel>
        </StackPanel>

        <!-- Список -->
        <ListView x:Name="listMaterials" Grid.Row="1" Grid.Column="0" Margin="10,0,10,10" 
                  Background="White" BorderThickness="1" BorderBrush="LightGray"
                  ScrollViewer.VerticalScrollBarVisibility="Disabled"
                  ScrollViewer.CanContentScroll="False"
                  SelectionMode="Single" GotFocus="listRecipes_GotFocus">

            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Изображение -->
                            <Image Source="{Binding CurrentPhoto}" Grid.Column="0" 
                                   Width="80" Height="80" Margin="0,0,15,0"
                                   VerticalAlignment="Top" Stretch="Uniform"/>

                            <!-- Текстовая информация -->
                            <StackPanel Grid.Column="1">
                                <!-- Первая строка -->
                                <TextBlock Margin="0,0,0,5">
                                    <Run Text="{Binding MaterialType.Name}" FontWeight="Bold"/>
                                    <Run Text=" | " FontWeight="Bold"/>
                                    <Run Text="{Binding Name}" FontWeight="Bold"/>
                                </TextBlock>

                                <!-- Вторая строка -->
                                <TextBlock Margin="0,0,0,5">
                                    <Run Text="Минимальное количество: "/>
                                    <Run Text="{Binding MinQuantity}"/>
                                    <Run Text=" шт"/>
                                </TextBlock>

                                <!-- Третья строка -->
                                <TextBlock Margin="0,0,0,5" TextWrapping="Wrap">
                                    <Run Text="Поставщики: "/>
                                    <Run Text="{Binding MaterialSuppliers, Converter={StaticResource SupplierNamesConverter}}"/>
                                </TextBlock>

                                <!-- Четвертая строка -->
                                <TextBlock>
                                    <Run Text="Остаток: "/>
                                    <Run Text="{Binding QuantityInStorage}" FontWeight="Bold" Foreground="Red"/>
                                    <Run Text=" шт"/>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Пагинация -->
        <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" 
                    HorizontalAlignment="Center" Margin="10,0,10,10">
            <Button x:Name="btnPrev" Content="&lt;" Width="30" Height="25" Margin="2" Click="BtnPrev_Click"/>

            <!-- Кнопки страниц будут создаваться в коде -->
            <ItemsControl x:Name="pageButtons" ItemsSource="{Binding PageNumbers}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Content="{Binding}" Width="30" Height="25" Margin="2" 
                                Click="PageButton_Click" Tag="{Binding}"
                                Background="{Binding Tag, RelativeSource={RelativeSource Self}, 
                                                    Converter={StaticResource PageToColorConverter}}" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Button x:Name="btnNext" Content="&gt;" Width="30" Height="25" Margin="2" Click="BtnNext_Click"/>
        </StackPanel>
    </Grid>
</Page>